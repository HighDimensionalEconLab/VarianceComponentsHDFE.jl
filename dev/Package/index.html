<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Package · VarianceComponentsHDFE.jl</title><link rel="canonical" href="https://HighDimensionalEconLab.github.io/VarianceComponentsHDFE.jl/Package/"/><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">VarianceComponentsHDFE.jl</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../Executable/">Executable</a></li><li class="is-active"><a class="tocitem" href>Package</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Setting-up-Development-Enviroment"><span>Setting up Development Enviroment</span></a></li><li class="toplevel"><a class="tocitem" href="#Functions-in-this-package"><span>Functions in this package</span></a></li><li><a class="tocitem" href="#Main-Function"><span>Main Function</span></a></li><li><a class="tocitem" href="#Auxiliary-Functions"><span>Auxiliary Functions</span></a></li><li class="toplevel"><a class="tocitem" href="#Datatypes-in-this-package"><span>Datatypes in this package</span></a></li><li class="toplevel"><a class="tocitem" href="#Typical-Julia-Workflow"><span>Typical Julia Workflow</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Package</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Package</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/HighDimensionalEconLab/VarianceComponentsHDFE.jl/blob/master/docs/src/Package.md#L" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Contents"><a class="docs-heading-anchor" href="#Contents">Contents</a><a id="Contents-1"></a><a class="docs-heading-anchor-permalink" href="#Contents" title="Permalink"></a></h1><ul><li><a href="#Contents">Contents</a></li><li><a href="#Setting-up-Development-Enviroment">Setting up Development Enviroment</a></li><li><a href="#Functions-in-this-package">Functions in this package</a></li><ul><li><a href="#Main-Function">Main Function</a></li><li><a href="#Auxiliary-Functions">Auxiliary Functions</a></li></ul><li><a href="#Datatypes-in-this-package">Datatypes in this package</a></li><li><a href="#Typical-Julia-Workflow">Typical Julia Workflow</a></li></ul><h1 id="Setting-up-Development-Enviroment"><a class="docs-heading-anchor" href="#Setting-up-Development-Enviroment">Setting up Development Enviroment</a><a id="Setting-up-Development-Enviroment-1"></a><a class="docs-heading-anchor-permalink" href="#Setting-up-Development-Enviroment" title="Permalink"></a></h1><ol><li>Install <a href="https://julialang.org/downloads/">Julia</a> and <a href="https://desktop.github.com/">GitHub Desktop</a> - not strictly required but never hurts to have it!</li><li>Install <code>vscode</code> and follow basic instructions in https://github.com/ubcecon/tutorials/blob/master/vscode.md<ul><li>In particular, https://github.com/ubcecon/tutorials/blob/master/vscode.md#julia, making sure to do the code formatter step.</li><li>and the git settings in https://github.com/ubcecon/tutorials/blob/master/vscode.md#general-packages-and-setup</li></ul></li><li>Clone the repo by either:<ul><li>Clicking on the <code>Code</code> then <code>Open in GitHub Desktop</code>.</li><li>Alternatively, you can go <code>] dev https://github.com/HighDimensionalEconLab/VarianceComponentsHDFE.jl</code> in a Julia REPL and it will clone it to the <code>.julia/dev</code> folder.</li><li>If you wanted to, you could then drag that folder back into github desktop.</li></ul></li><li>Open it in vscode by right-clicking on the folder it installed to, and then opening a vscode project.</li><li>Open the Julia repl in vscode  (<code>Ctrl-Shift-P</code> and then go <code>Julia REPL</code> or something to find it.</li><li>type <code>] instantiate</code> to install all of the packages.  Get coffee.</li><li>In the REPL run <code>] test</code> and it should do the full unit test.</li></ol><h1 id="Functions-in-this-package"><a class="docs-heading-anchor" href="#Functions-in-this-package">Functions in this package</a><a id="Functions-in-this-package-1"></a><a class="docs-heading-anchor-permalink" href="#Functions-in-this-package" title="Permalink"></a></h1><h2 id="Main-Function"><a class="docs-heading-anchor" href="#Main-Function">Main Function</a><a id="Main-Function-1"></a><a class="docs-heading-anchor-permalink" href="#Main-Function" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="VarianceComponentsHDFE.leave_out_KSS-Tuple{Any, Any, Any}" href="#VarianceComponentsHDFE.leave_out_KSS-Tuple{Any, Any, Any}"><code>VarianceComponentsHDFE.leave_out_KSS</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">leave_out_KSS(y, first_id, second_id; controls, do_lincom, Z_lincom, lincom_labels, settings)
</code></pre><p>Returns a tuple with the observation number of the original dataset that belongs to the Leave-out connected set as described in Kline,Saggio, Solvesten. It also provides the corresponding outcome and identifiers in this connected set. </p><p><strong>Arguments</strong></p><ul><li><code>y</code>: outcome vector</li><li><code>first_id</code>: first identifier (e.g. worker id)</li><li><code>second_id</code>: second identifier (e.g. firm id)</li><li><code>controls</code>: covariates that will be partialled out from outcome before it performs KSS.</li><li><code>do_lincom</code>: boolean that indicates whether it runs inference. </li><li><code>Z_lincom</code>: matrix of covariates to be used in lincom inference.</li><li><code>lincom_labels</code>: vector of labels of the columns of Z_lincom.</li><li><code>settings</code>: settings based on <code>VCHDFESettings</code></li><li><code>controls</code>: at this version only <code>controls=nothing</code> is supported.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/HighDimensionalEconLab/VarianceComponentsHDFE.jl/blob/01573828fefcf10225ada4c265a702618d54b301/src/leave_out_correction.jl#LL385">source</a></section></article><h2 id="Auxiliary-Functions"><a class="docs-heading-anchor" href="#Auxiliary-Functions">Auxiliary Functions</a><a id="Auxiliary-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Auxiliary-Functions" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-binding" id="VarianceComponentsHDFE.find_connected_set-NTuple{4, Any}" href="#VarianceComponentsHDFE.find_connected_set-NTuple{4, Any}"><code>VarianceComponentsHDFE.find_connected_set</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">find_connected_set(y, first_idvar, second_idvar, settings)
</code></pre><p>Returns a tuple of observation belonging to the largest connected set with the corresponding identifiers and outcomes. This requires to have the data sorted by first identifier, and time period (e.g. we sort by worked id and year). This is also the set where we can run AKM models with the original data.</p><p><strong>Arguments</strong></p><ul><li><code>y</code>: outcome (e.g. log wage)</li><li><code>first_id</code>: first identifier (e.g. worker id)</li><li><code>second_id</code>: second identifier (e.g. firm id)</li><li><code>settings</code>: settings based on data type <code>VCHDFESettings</code>. Please see the reference provided below.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/HighDimensionalEconLab/VarianceComponentsHDFE.jl/blob/01573828fefcf10225ada4c265a702618d54b301/src/leave_out_correction.jl#LL101">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="VarianceComponentsHDFE.get_leave_one_out_set-NTuple{5, Any}" href="#VarianceComponentsHDFE.get_leave_one_out_set-NTuple{5, Any}"><code>VarianceComponentsHDFE.get_leave_one_out_set</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">get_leave_one_out_set(y, first_id, second_id, settings, controls)
</code></pre><p>Returns a tuple with the observation number of the original dataset that belongs to the Leave-out connected set as described in Kline,Saggio, Solvesten. It also provides the corresponding outcome and identifiers in this connected set. </p><p><strong>Arguments</strong></p><ul><li><code>y</code>: outcome vector</li><li><code>first_id</code>: first identifier (e.g. worker id)</li><li><code>second_id</code>: second identifier (e.g. firm id)</li><li><code>settings</code>: settings based on <code>VCHDFESettings</code></li><li><code>controls</code>: at this version only <code>controls=nothing</code> is supported.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/HighDimensionalEconLab/VarianceComponentsHDFE.jl/blob/01573828fefcf10225ada4c265a702618d54b301/src/leave_out_correction.jl#LL358">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="VarianceComponentsHDFE.leave_out_estimation-NTuple{5, Any}" href="#VarianceComponentsHDFE.leave_out_estimation-NTuple{5, Any}"><code>VarianceComponentsHDFE.leave_out_estimation</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">leave_out_estimation(y, first_id, second_id, controls, settings)
</code></pre><p>Returns the bias-corrected components, the vector of coefficients, the corresponding fixed effects for every observation, and the diagonal matrices containing the Pii and Biis. </p><p><strong>Arguments</strong></p><ul><li><code>y</code>: outcome vector</li><li><code>first_id</code>: first identifier (e.g. worker id)</li><li><code>second_id</code>: second identifier (e.g. firm id)</li><li><code>settings</code>: settings based on <code>VCHDFESettings</code></li><li><code>controls</code>: matrix of control variables. At this version it doesn&#39;t work properly for very large datasets.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/HighDimensionalEconLab/VarianceComponentsHDFE.jl/blob/01573828fefcf10225ada4c265a702618d54b301/src/leave_out_correction.jl#LL554">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="VarianceComponentsHDFE.compute_movers-Tuple{Any, Any}" href="#VarianceComponentsHDFE.compute_movers-Tuple{Any, Any}"><code>VarianceComponentsHDFE.compute_movers</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">compute_movers(first_id, second_id)
</code></pre><p>Returns a vector that indicates whether the <code>first_id</code> (e.g. worker) is a mover across <code>second_id</code> (e.g. firms), as well as a vector with the number of periods that each <code>first_id</code> appears.</p><p><strong>Arguments</strong></p><ul><li><code>first_id</code>: first identifier (e.g. worker id)</li><li><code>second_id</code>: second identifier (e.g. firm id)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/HighDimensionalEconLab/VarianceComponentsHDFE.jl/blob/01573828fefcf10225ada4c265a702618d54b301/src/leave_out_correction.jl#LL302">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="VarianceComponentsHDFE.compute_matchid-Tuple{Any, Any}" href="#VarianceComponentsHDFE.compute_matchid-Tuple{Any, Any}"><code>VarianceComponentsHDFE.compute_matchid</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">compute_matchid(second_id, first_id)
</code></pre><p>Computes a match identifier for every combination of first and second identifier. For example, this can be the match identifier of worker-firm combinations.</p><p><strong>Arguments</strong></p><ul><li><code>first_id</code>: first identifier (e.g. worker id)</li><li><code>second_id</code>: second identifier (e.g. firm id)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/HighDimensionalEconLab/VarianceComponentsHDFE.jl/blob/01573828fefcf10225ada4c265a702618d54b301/src/leave_out_correction.jl#LL341">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="VarianceComponentsHDFE.lincom_KSS-NTuple{5, Any}" href="#VarianceComponentsHDFE.lincom_KSS-NTuple{5, Any}"><code>VarianceComponentsHDFE.lincom_KSS</code></a> — <span class="docstring-category">Method</span></header><section><div><pre><code class="language-julia">lincom_KSS(y, X, Z, Transform, sigma_i; lincom_labels)
</code></pre><p>This function regresses fixed effects based onto some observables. See appendix in KSS for more information.</p><p><strong>Arguments</strong></p><ul><li><code>y</code>: outcome variable.</li><li><code>X</code>: the design matrix in the linear model.</li><li><code>Z</code>: matrix of observables to use in regression.</li><li><code>Transform</code>: matrix to compute fixed effects (e.g. Transform = [0 F] recovers second fixed effects).</li><li><code>sigma_i</code>: estimate of the unbiased variance of observation i.</li><li><code>lincom_labels</code>: labels of the columns of Z.</li><li><code>settings</code>: settings based on data type <code>VCHDFESettings</code>. Please see the reference provided below.</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/HighDimensionalEconLab/VarianceComponentsHDFE.jl/blob/01573828fefcf10225ada4c265a702618d54b301/src/leave_out_correction.jl#LL910">source</a></section></article><h1 id="Datatypes-in-this-package"><a class="docs-heading-anchor" href="#Datatypes-in-this-package">Datatypes in this package</a><a id="Datatypes-in-this-package-1"></a><a class="docs-heading-anchor-permalink" href="#Datatypes-in-this-package" title="Permalink"></a></h1><article class="docstring"><header><a class="docstring-binding" id="VarianceComponentsHDFE.ExactAlgorithm" href="#VarianceComponentsHDFE.ExactAlgorithm"><code>VarianceComponentsHDFE.ExactAlgorithm</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">struct ExactAlgorithm &lt;: AbstractLeverageAlgorithm</code></pre><p>Data type to pass to VCHDFESettings type, to indicate Exact algorithm</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/HighDimensionalEconLab/VarianceComponentsHDFE.jl/blob/01573828fefcf10225ada4c265a702618d54b301/src/leave_out_correction.jl#LL24">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="VarianceComponentsHDFE.JLAAlgorithm" href="#VarianceComponentsHDFE.JLAAlgorithm"><code>VarianceComponentsHDFE.JLAAlgorithm</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">struct JLAAlgorithm &lt;: AbstractLeverageAlgorithm</code></pre><p>Data type to pass to VCHDFESettings type, to indicate JLA algorithm</p><p><strong>Fields</strong></p><ul><li><code>num_simulations</code>: number of simulations in estimation. If num_simulations = 0, defaults to 100 * log(#total fixed effect)&quot;</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/HighDimensionalEconLab/VarianceComponentsHDFE.jl/blob/01573828fefcf10225ada4c265a702618d54b301/src/leave_out_correction.jl#LL31">source</a></section></article><article class="docstring"><header><a class="docstring-binding" id="VarianceComponentsHDFE.VCHDFESettings" href="#VarianceComponentsHDFE.VCHDFESettings"><code>VarianceComponentsHDFE.VCHDFESettings</code></a> — <span class="docstring-category">Type</span></header><section><div><pre><code class="language-julia">struct VCHDFESettings{LeverageAlgorithm}</code></pre><p>The VCHDFESettings type is to pass information to methods regarding which algorithm to use. </p><p><strong>Fields</strong></p><ul><li><code>cg_maxiter</code>: maximum number of iterations (default = 300)</li><li><code>leave_out_level</code>: leave-out level (default = match)</li><li><code>leverage_algorithm</code>: which type of algorithm to use (default = JLAAlgorithm())</li><li><code>first_id_effects</code>: includes first id effects. At this version it is required to include the first<em>id</em>effects. (default = true)</li><li><code>cov_effects</code>: includes covariance of first-second id effects. At this version it is required to include the cov_effects. (default = true)</li><li><code>print_level</code>: prints the state of the program in std output. If print_level = 0, the app prints nothing in the std output. (default = 1)</li><li><code>first_id_display_small</code>: name of the first id in lower cases (default = person)</li><li><code>first_id_display</code>: name of the first id (default = Person)</li><li><code>second_id_display_small</code>: name of the second id in lower cases (default = firm)</li><li><code>second_id_display</code>: name of the second id (default = Firm)</li><li><code>outcome_id_display_small</code>: name of the observation id in lower cases (default = wage)</li><li><code>outcome_id_display</code>: name of the observation id (default = Wage)</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/HighDimensionalEconLab/VarianceComponentsHDFE.jl/blob/01573828fefcf10225ada4c265a702618d54b301/src/leave_out_correction.jl#LL44">source</a></section></article><h1 id="Typical-Julia-Workflow"><a class="docs-heading-anchor" href="#Typical-Julia-Workflow">Typical Julia Workflow</a><a id="Typical-Julia-Workflow-1"></a><a class="docs-heading-anchor-permalink" href="#Typical-Julia-Workflow" title="Permalink"></a></h1><pre><code class="language-none">#Load the required packages
using VarianceComponentsHDFE, DataFrames, CSV, SparseArrays

#Load dataset
data = DataFrame(CSV.File(&quot;test.csv&quot;; header=false))

#Extract vectors of outcome, workerid, firmid
id = data[:,1]
firmid = data[:,2]
year = data[:, 3]
y = data[:,4]

#You can define the settings using our structures
JL = JLAAlgorithm(num_simulations = 300)
mysettings = VCHDFESettings(leverage_algorithm = JL, first_id_effects=true, cov_effects=true)

#Run KSS with no controls 
θ_first, θ_second, θCOV = leave_out_KSS(y,id,firmid)

#Create some controls and run the routine where we partial out them
controls = indexin(year,unique(sort(year)))
controls = sparse(collect(1:size(y,1)), controls, 1, size(y,1), maximum(controls))
controls = controls[:,1:end-1]

θ_first, θ_second, θCOV = leave_out_KSS(y,id,firmid; controls)

#Perform Lincom Inference using a Region Dummy
data = DataFrame!(CSV.File(&quot;lincom.csv&quot;; header=false))
id = data[:,1]
firmid = data[:,2]
y = data[:,5]
region = data[:,4] 
region[findall(region.==-1)].=0

θ_first, θ_second, θCOV = leave_out_KSS(y,id,firmid; do_lincom = true , Z_lincom = region, lincom_labels = [&quot;Region Dummmy&quot;] )

</code></pre></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../Executable/">« Executable</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Thursday 9 June 2022 00:54">Thursday 9 June 2022</span>. Using Julia version 1.6.6.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
